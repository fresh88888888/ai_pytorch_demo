
#### 美团餐饮SaaS平台

美团餐饮SaaS平台为餐饮企业提供餐厅数字化解决方案（一站式IT解决方案），帮餐厅实现从前厅管理、后厨生产管理、会员管理、线上运营管理、供应链管理到外卖的数字化经营。美团餐饮系统实现了餐厅和平台的打通，帮助餐厅连接顾客，帮餐饮商户更了解顾客、商圈，有助于做商业决策。并给顾客带来更好的消费体验（覆盖县市区旗：2800+、用户年均交易笔数：37.2、年度交易用户：6.9亿、业务品类：200+、活跃商户：900万户）。而美团之所以由餐饮C端向餐饮B端延伸：
- C端流量红利不再，存在巨大需求和机会的B端市场有望成为美团的第二增长曲线。随着互联网人口红利的逐渐消失，美团围绕流量的团购、外卖等C端生意逐渐触及到天花板。而围绕B端商家，美团可以在增值服务等方面开发更多的客户，获得更多的增长机会。
- 在C端业务遭遇瓶颈的当下，美团发展B端能反向推动C端，从而加固自身壁垒。B端商家的数字化能力较差，商家的硬件、软件、管理和服务都还没有跟上，各环节效率得不到提升，美团想要打开更大的C端市场就会困难重重。美团To B服务可以全面提升商家的服务品质和效率，而这种对B端的提升最终又能传导到C端，促进C端业务的发展。更何况，美团在C端所拥有的流量、商家、地推优势，都是其发力B端的一大助力。美团拥有庞大的消费者流量及数据资源，可以帮助商家进行精准用户画像；另外美团在餐饮外卖上所积累的商家资源也可以看作其拓展B端市场的最佳客户；而且美团强大的地推能力对其收录商户的数量和质量都能带来一定助力，能更好地促进其B端产品的落地。在C端优势的加持下，美团B端将释放出更大能量，进一步稳固其在生活服务领域的地位。
- 一体化的产品和服务能有效提升协作效率。在过去，餐饮行业业务繁琐，审批流程复杂，线上线下无法成功对接。而一体化的餐饮SaaS系统则涵盖了从点餐、收银、预订、排队到后厨管理、连锁管理及供应链管理等一系列餐饮服务工具，任何一个环节都能在同一系统中实现自动化流转，这不仅可以帮助经营者提升各部门之间的协作效率，还能为消费者提供更高效快捷的体验。
- 一体化的产品和服务能合理降低人力成本。餐企行业特别是连锁品牌，往往具有门店区域分散、人员流动频繁等特点，这也就意味着大部分餐企的人力资源部门需要对员工进行线上招聘、培训、管理和服务等，其中的成本可想而知。而成熟先进的餐饮SaaS已经能从最开始的采购，贯穿到顾客买单、顾客维护、人力管理以及供应链、数据中台等各个环节，能帮助众多餐饮商户缩减人力成本、增加经营收益。
- 一体化的产品和服务能更好地解决供应链痛点。餐饮行业全流程业务紧密相连，数据流、业务流、资金流等任何一方的割裂，都会为餐企开展业务带来重重障碍。比如在疫情中，很多小型或个人餐饮店出现了库存积压困难，进而导致现金流断裂最终不得不选择闭店。而一体化餐饮SaaS系统则可以实现标准化的采购流程，通过数字化分析预测、按需采购，在一定程度上帮助企业开源节流。

##### 挑战

餐饮SaaS面临的挑战：
- 一体化IT解决方案：线上线下一体化，软硬件一体化，店内部署难。线上引流（外卖、团购、预定、排队、买单、评价），线下体验（顾客服务、前厅[点单、支付]收银、餐厅管理[进销存、经营分析、财务管理、会员营销]、后厨管理[KDS、后厨分单、传菜划单]）。
- 业务复杂度高：业态多、业务端多、用户角色多、业务领域多。
- 可用性要求高：餐厅经营重度依赖门店弱网/断网可经营。
- 研发投入大：跨地域、多团队、外包。

![](/img/saas_architecture_1.png "餐饮SaaS面临的挑战")

##### 架构方法

架构方法：业务架构基于企业架构方法论(TOGAF)，技术架构：采用架构五视图（逻辑架构、开发架构、数据架构、物理架构、运行架构）。架构的关键原则：基于领域驱动设计。

技术架构：
- 架构管控：事前 -架构设计规范、通用能力及组件。事中 -工具检查，定期架构review。事后 -方案设计，架构评审。
- 通用能力及组件：统一的SaaS多租户和管控体系。统一的网关组件(API、流量)。统一的业务集成平台（可插拔平台、开发平台）。店内业务组件(本地服务：localserver)。
- 架构交付物：需求分析（功能&非功能性需求、业务流程）。技术选型与学习最佳实践。架构五视图（逻辑、开发、数据、运行、部署架构）。非功能性设计（安全、稳定性设计）。

##### 研发标准化

研发标准化：
- 设计标准化：设计规范、分层架构、业务平台化。
- 技术栈标准化：模板工程、中间件统一、组件化。
- 服务标准化：微服务、SOA、鉴权组件、脱敏组件、统一灰度、管控组件、限流组件、熔断降级组件、内容审核组件等。
- 测试标准化：CI/CD、sonar、专项测试、自动化测试。
- 运维标准化：灰度、稳定性大盘、故障大盘、故障演练、日志回捞、业务/服务监控、预案管理、值班制度等。

规范统一：项目管理规范、设计规范、代码规范、中间件规范（数据库）、接口规范、环境规范、提测规范、上线规范、报警处理规范等。研发过程度量：研发过程数字化、指标度量系统。
![](/img/saas_architecture.png "餐饮SaaS架构图")

##### 店内经营系统

![](/img/saas_architecture_2.png "餐饮SaaS-店内经营系统的历史演进")

##### 店内经营系统 - 架构

![](/img/saas_architecture_3.png "餐饮SaaS-店内经营系统架构")

##### 店内经营系统 - 交互

![](/img/saas_architecture_4.png "餐饮SaaS-店内经营系统交互")

关键策略：技术问题和业务问题分离，屏蔽技术差异（技术框架）。业务领域化拆分，云店一体化（基础组件建设）。研发和运维流程工具建设，提升研发效率（研发流程支撑）。

###### 技术框架（Local-Server-Framework）

Local-Server-Framework 跨平台开发框架，高高效支支撑服务端同学开发店内业务逻辑，解决复杂 的业务逻辑运行边缘节点的能力，框架涵盖web模块、存储模块、容 器器模块、配置模块、工工具模块和测试模块。框架特点： 
- 支持跨平台（Android、windows、linux）。
- 开发体验好和成本低，基本和Spring开发体验保持一致。
- 低耦合，framework、平台组件、业务模块解耦，业务同学只关注业务代码。
- 性能好，静态编译期处理理，避免动态运行行行时加载，提升启动性能。
- 工具化：打包工具、调试工具、发版工具、运维工具 web 容器。

![](/img/saas_architecture_5.png "餐饮SaaS-店内经营系统-技术框架")

###### 基础组件

![](/img/saas_architecture_6.png "餐饮SaaS-店内经营系统-基础组件")

###### 云店协同组件

店内经营业务： 主数据（SaaS云端）+ 店内业务代码（LocalServer，无状态） = 业务数据（SaaS云端）。主数据即时下发到店内，业务数据及时同步到SaaS云端。
- 数据协同：主数据从云端下发店内：在经营前，商家需要在云端配置好自自己己的菜 品、桌台、支支付方方式等等，需要保证配置数据更更新及时性。业务数据从店内同步云端：经营中产生生的订单、班次上传到云端，做 大大数据分析 
- 业务协同：云店业务实时协同：店内作为餐厅经营的处理理中心心，需要协同处理理云 端顾客扫码点餐业务，保障业务的一致性。

![](/img/saas_architecture_7.png "餐饮SaaS-店内经营系统-云店协同组件")

组件能力：店内业务逻辑开发无无需关注数据协同，配置更更新组件、数据同步组件、业务协同组件。
技术能力：https、长链、外网MQ、外网RPC（上下行，提供丰富的网络通信能力支撑）。

###### 开发模式

![](/img/saas_architecture_8.png "餐饮SaaS-开发模式")

通过框架和工具建设，提升店内业务研发效率：
- 模块化研发：模块化研发，按照领域划分，代码和存储均独 立，模块之间及基于接口交互。
- 开发习惯同Spring框架：IOC、AOP、注解、代码分层、yaml配置。
- 高效打包：动态编译、增量量编译、服务端和Localserver统一打包工具。
- pipeline流水水线：git push流水线、PR流水线、提测流水线。

###### 发布模式

- 发布方式：随客户端发版:商家有感升级，适合大版本发布。静默升级:商家无感升级，适合小版本发布。热更新：hotfix。
- 发布管控：流程规范：需求、编码、测试、集成、发布。质量量卡点：提测卡控、集成卡控、验收卡控、灰度发版。

![](/img/saas_architecture_9.png "餐饮SaaS-发布模式")

###### 灰度模式

问题：
- 店内经营端各个终端和LocalServer如何保证版本兼容和一致？
- 管理端、C端、店内经营端如何保证灰度一致？
- 服务端灰度上线，终端灰度发版，如何能够在保证稳定性情况下，加速灰度节奏，尽快交付商家？ 

解决方方案：
- 沙箱和AB模式两种，服务端全链路路灰度能力。
- 统一灰度池，保证单商户各终端升级版本一致性。
- 支持客户端、前端、后端、数据端等所有端协同灰度。
- 精细化的灰度控制（黑白名单、多维度百分比）。

![](/img/saas_architecture_10.png "餐饮SaaS-灰度模式")

###### 店内监控

业务运行在店内，如何对边缘节点的业务进行监控？App端到端监控（网络成功率、响应时间、运营商等）。业务指标监控（交易易、支支付、接单、打印、消息等）。应用用层监控（异常、请求数、响应时间、存活性）。系统层监控（CPU、内存、磁盘、GC、外设）。

![](/img/saas_architecture_11.png "餐饮SaaS-店内监控")

![](/img/saas_architecture_12.png "美团餐饮-全业务模块SaaS")

